const url ='https://raw.githubusercontent.com/ndlopez/jumble_game/main/static/jumble_words.json';

var jumble_words = [];
let numWords = 4;
var usedWords = [];
var text = "";

/* Parse JSON file generated by Ruby code. 
Output random shuffled words*/
String.prototype.shuffle = function () {
    var a = this.split(""),
        n = a.length;
    for(var i = n - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var tmp = a[i];
        a[i] = a[j];
        a[j] = tmp;
    }
    return a.join("");
}
let counter = 0;
fetch(url)
.then((response) => {
	return response.json()
})
.then((jumble_words)=>{
    for (let jdx = 0; jdx < numWords; jdx++) {
        randIdx = Math.floor(Math.random()*jumble_words.length);
        var jumble_word = jumble_words[randIdx];
        //usedWords.push(jumble_word);
        jumble_word = jumble_word.toUpperCase();
        text += "<div class='row' id='shufWord'><h2>" + jumble_word.shuffle() + "</h2></div>";
        /* Build as many inputs as the length of a word*/
        text += "<div class='row'>";
        for (let idx = 0; idx < jumble_word.length; idx++) {
            text += "<div class='oneLetterCol'><input class='wrongAns' ";
            text += "id='"+ jumble_word[idx]+"' maxlength=1></div>";            
        }
        text += "<div class='result'></div>"
        text += "</div><div class='row separator'></div>";
        
        console.log("word ",jumble_word,jdx);

        valid_input(jumble_word);
        document.getElementById("jumble_this_word").innerHTML = text;

        /* validation should run here....*/
    }

    function valid_input(thisValue){
        for(let thisLtr of thisValue){
            thisLtr = thisLtr.toUpperCase();
            let inputVal = document.getElementById(thisLtr);
            inputVal.onkeyup = function(){
                var myVal = inputVal.value;
                if (myVal.toUpperCase() === thisLtr){
                    inputVal.classList.remove("wrongAns");
                    inputVal.classList.add("correctAns");
                    counter += 1;
                }
                else{
                    if(myVal.value === "" || myVal.toUpperCase !== thisLtr){
                        inputVal.classList.remove("correctAns");
                        inputVal.classList.add("wrongAns");
                    }
                }
            }
        }
    }
    
    /*for (let idx = 0; idx < usedWords.length; idx++) {
        for (let letter of usedWords[idx]){
            letter = letter.toUpperCase();
            let inputVal = document.getElementById(letter);
            inputVal.onkeyup = function(){
                var myVal = inputVal.value;
                if (myVal.toUpperCase() === letter){
                    inputVal.classList.remove("wrongAns");
                    inputVal.classList.add("correctAns");
                    counter += 1;
                }
                else{
                    if(myVal.value === "" || myVal.toUpperCase !== letter){
                        inputVal.classList.remove("correctAns");
                        inputVal.classList.add("wrongAns");
                    }
                }
            }
            console.log("correct ans",counter);
        }
        console.log("total letters in ",usedWords[idx],usedWords[idx].length);
    }*/
    //console.log("total",usedWords.length);

    //console.log(jumble_words);
})
.catch((err)=>{
	console.log("Couldnt fetch " + jumble_words + err);
});
